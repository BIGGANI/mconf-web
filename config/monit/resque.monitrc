# Add this to your /etc/monit/monitrc
#   include /var/www/mconf-web/current/config/monit/resque.monitrc

check process resque_worker_bigbluebutton_rails
  with pidfile /var/www/mconf-web/current/tmp/pids/resque_worker_bigbluebutton_rails.pid
  start program = "/usr/bin/env HOME=/home/mconf PATH=/usr/local/bin:/usr/local/ruby/bin:/usr/bin:/bin:$PATH /bin/sh -l -c 'cd /var/www/mconf-web/current; nohup bundle exec rake environment resque:work RAILS_ENV=production QUEUE=bigbluebutton_rails VERBOSE=1 PIDFILE=tmp/pids/resque_worker_bigbluebutton_rails.pid >> log/resque_worker_bigbluebutton_rails.log 2>&1'"
    as uid mconf and gid mconf
  stop program = "/bin/sh -c 'cd /var/www/mconf-web/current && kill -9 $(cat tmp/pids/resque_worker_bigbluebutton_rails.pid) && rm -f tmp/pids/resque_worker_bigbluebutton_rails.pid; exit 0;'"
  if totalmem is greater than 300 MB for 10 cycles then restart # eating up memory?
  group resque_workers
