<% menu :events %>
<% atom_link_header(space, Event.new) %>

<%content_for :headers do%>
  <%= javascript_include_tag 'jquery.timeentry','jquery.mousewheel' %>
<%end%>

<% content_for :sidebar do  %>
	<%if @space.authorize?([:create, :content],:to => current_user)%>	
	  <%if params[:edit]%>
    	<%=render :partial => 'edit_event', :locals => {:event => @event_to_edit}%>
  	  <%else%>
    	<%= render :partial=> 'new_event', :locals => {:checked_users => Array.new}%>
  	  <%end%>
	<%else%>
      <%if logged_in? && space.public?%>
		<% form_tag space_join_requests_path(space), :id => "join_form" do %>
	      <button class="join-space" type:"submit"><%=t('space.join')%></button>
	    <% end %>
	  <%else%>
		<%=link_to "<button class='join-space'>"+t('space.join')+"</button>", new_space_join_request_path(space), :class => "fancybox_link" %>
	  <%end%>
		<div class="space-desc">
		  <h3><%= t('about') %> <em><%=@space.name%></em></h3>
		  <p><%=image_tag(logo_image_path(@space, :size =>48), :align => "left")%>
		  <%= sanitize(space.description) if space.description.present? %></p>
  		</div>		
	<%end%>
<%end%>

<% content_for :javascript do %>

<!-- select links -->
$(".event_navigation,.date_link,div.pagination a").livequery("click",function(){
	var route = $(this).attr("href");
  $.get(route,
      {authenticity_token: "<%=form_authenticity_token()%>"},
      function(data){
        $("#events_content").replaceWith(data);
      }
    );
	return(false);
});

	$("#query").click(function(){
	  if(this.value == "Search Events..."){
		  this.value="";
		}
	});
		
<%= render :partial => 'date_and_timepicker.js.erb' %>

<% end %>

<% content_for :search do  %>
  <% form_tag(search_events_path(@space)) do %>
      <%= text_field_tag 'query',(params[:query] ? params[:query] :  t('event.search'))%>
	   <button type="submit"><%=t("button.go")%></button>
	   <div id="advanced">
	     <%= link_to t('advanced'), advanced_search_events_path(@space) %>
     </div>
   <% end %>
<%end%>

<div id="events_content">
	
<%if !@current_events.empty?%>
  <div id="current_events">
    <h3><%= t('now!') %></h3>
    <%for event in @current_events%>
      <%= render :partial => event %>
    <%end%>
  </div>
<%end%>
	
	<div class="group_links" id="events_links">
	  <%=link_to t('all'), space_events_path(@space), {:id => 'all_link', :class => "#{params[:show] ? 'event_navigation' : 'event_navigation event_selected'}"}%> |
	  <%=link_to t('upcoming'), space_events_path(@space, :show => "upcoming_events"), {:class => "#{params[:show] == 'upcoming_events' ? 'event_navigation upcoming_link event_selected' : 'event_navigation upcoming_link'}"}%> |
	  <%=link_to t('past'), space_events_path(@space, :show => "past_events"), {:class => "#{params[:show] == 'past_events' ? 'event_navigation past_link event_selected' : 'event_navigation past_link'}"}%> 
	</div>  
	 
	<%if params[:show] == 'past_events'%>
			<%= render :partial => 'past_events' %>
	<%elsif params[:show] == 'upcoming_events' %>
		  <%= render :partial => 'upcoming_events' %>
	<%else%>	
		  <%= render :partial => 'all_events' %>
	<%end%>
</div>
