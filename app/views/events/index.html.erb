<% menu :events %>
<% atom_link_header(space, Event.new) %>

<%content_for :headers do%>
  <%= javascript_include_tag 'jquery.timeentry','jquery.mousewheel' %>
<%end%>

<%if @space.authorizes?([:create, :content],:to => current_user)%>
	<% content_for :sidebar do  %>
  	<%if params[:edit]%>
    	<%@event = Event.find(params[:edit])%>
    	<%=render :partial => 'edit_event'%>
  	<%else%>
    	<%= render :partial=> 'new_event'%>
  	<%end%>
	<%end%>
<%end%>

<% content_for :javascript do %>

<!-- select links -->
$(".event_navigation,.date_link,div.pagination a").livequery("click",function(){
	var route = $(this).attr("href");
  $.get(route,
      {authenticity_token: "<%=form_authenticity_token()%>"},
      function(data){
        $("#events_content").replaceWith(data);
      }
    );
	return(false);
});
		
$(".no_javascript").after(
  "<div class='javascript'><input type='date' id='start_datepicker' name='event[start_date]' class= 'datepicker small-font' value= <%= @event.present? ? @event.start_date.month.to_s + "/" + @event.start_date.day.to_s + "/" + @event.start_date.year.to_s : "" %>> <%=escape_javascript(link_to "Start date", "javascript:start_datepicker_setdate()")%><br/> "  
	+ "<input type='time' id='start_timepicker' name='event[start_hour]' class='timepicker small-font' value= <%= @event.present? ? @event.start_date.to_time.hour.to_s + ":" + @event.start_date.to_time.min.to_s + ":" + @event.start_date.to_time.sec.to_s : "" %>> <%=escape_javascript(link_to "Start hour", "javascript:start_timepicker_setTime()")%><br/>"   
	+ "<input type='date' id='end_datepicker' name='event[end_date]' class='datepicker small-font'value= <%= @event.present? ? @event.end_date.month.to_s + "/" + @event.end_date.day.to_s + "/" + @event.end_date.year.to_s : "" %>> <%=escape_javascript(link_to "End date", "javascript:end_datepicker_setdate()")%><br/>"
	+ "<input type='time' id='end_timepicker' name='event[end_hour]' class='timepicker small-font' value= <%= @event.present? ? @event.end_date.to_time.hour.to_s + ":" + @event.end_date.to_time.min.to_s + ":" + @event.end_date.to_time.sec.to_s : "" %>> <%=escape_javascript(link_to "End hour", "javascript:end_timepicker_setTime()", :class => "timepicker_launcher")%></div>"

);
$(".no_javascript").remove();

/*
 * Timepicker and datepicker configuration
 */

$(".datepicker").datepicker();
$('.timepicker').timeEntry({show24Hours: true, showSeconds: true, spinnerImage: '../../images/ui/up-down.png', 
    spinnerSize: [15, 16, 0], spinnerBigSize: [30, 32, 0], spinnerIncDecOnly: true, show24Hours: true });

start_timepicker_setTime = function(){
  $("#start_timepicker").timeEntry('setTime');
};


/*
 * Timepicker and datepicker launch functions
 */

end_timepicker_setTime = function(){
  $("#end_timepicker").timeEntry('setTime');
};

start_datepicker_setdate = function(){
  $("#start_datepicker").datepicker('show');
};

end_datepicker_setdate = function(){
  $("#end_datepicker").datepicker('show');
};

/*
 * Jquery timepicker calls to set timepicker clicking time
 */

$("#start_timepicker").click(function(){
  if($(this).val()==""){
    start_timepicker_setTime()
	}
});

$("#end_timepicker").click(function(){
  if($(this).val()==""){
	  end_timepicker_setTime()
	}
});

<% end %>

<% content_for :search do  %>
  <% form_tag(search_events_path(@space)) do %>
      <%= text_field_tag :query, params[:query], :size=>'18' %>
	   <%= image_submit_tag "buttons/search.png"%>
	   <div id="advanced">
	     <%= link_to 'Advanced', advanced_search_events_path(@space) %>
     </div>
   <% end %>
<%end%>

<div id="events_content">
	<div class="group_links" id="events_links">
	  <%=link_to "All", space_events_path(@space), {:id => 'all_link', :class => "#{params[:show] ? 'event_navigation' : 'event_navigation event_selected'}"}%> |
	  <%=link_to "Incoming", space_events_path(@space, :show => "incoming_events"), {:class => "#{params[:show] == 'event_navigation incoming_events' ? 'event_navigation incoming_link event_selected' : 'event_navigation incoming_link'}"}%> |
	  <%=link_to "Past", space_events_path(@space, :show => "past_events"), {:class => "#{params[:show] == 'past_events' ? 'event_navigation past_link event_selected' : 'event_navigation past_link'}"}%> 
	</div>  
	 
	<%if params[:show] == 'past_events'%>
			<%= render :partial => 'past_events' %>
	<%elsif params[:show] == 'incoming_events' %>
		  <%= render :partial => 'incoming_events' %>
	<%else%>	
		  <%= render :partial => 'all_events' %>
	<%end%>
</div>