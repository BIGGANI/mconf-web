<% content_for :javascript do %>  
  $("#organizers_name").fcbkcomplete({
	cache: true,
            filter_case: false,
            filter_hide: true,
            firstselected: true,
            filter_selected: true,
            maxshownitems: 4
  });
  
  template = "<%= t('user.invitation.message') %>\n<%= t('user.invitation.sign',:username=>current_user.login) %>";
  $("#event_name").blur(function(){
    replace_invitation();
  });
  
  function replace_invitation(){
    if(edited_msg==true)
      return;
	
    invitation_text = template;
    if($("#event_name").val()!=""){
     invitation_text = invitation_text.replace('event_name',$("#event_name").val());
    }
   if($("#start_datepicker").val()!=""){
     invitation_text = invitation_text.replace('event_date',$("#start_datepicker").val() + " at " + $("#start_timepicker").val());
   }  
   $("#invite_msg").val(invitation_text);
  };
  
  
  //we detect the user editing the invitation message
  old_text = "";
  edited_msg = false;
  $("#invite_msg").focus(function(){
    old_text = $("#invite_msg").val();
  });
  
  $("#invite_msg").blur(function(){
    if( $("#invite_msg").val() != old_text)
	{
	  edited_msg = true;
	}
  });
  
  $(document).ready(function() {
  	$("#change-event").effect("highlight", {color:"#F5DF51"}, 3000);
  	 replace_invitation();
  });
<% end %>
<% content_for :headers do  -%>
  <%= javascript_include_tag 'jquery.fcbkcomplete'%>
  <%= stylesheet_link_tag "fcbkcomplete", :media => "screen, projection" %>
<% end -%>

<div id="change-event">

<div id="help" title="These are the latest posts or events that you've created"></div>
<h3><%= t('event.edit') %>hola</h3>

<% form_for([@space,event], :html => { :multipart => true}) do |f| -%>
  <%= f.error_messages %>				
  <div>
    <label for="Name"><%= t('name.one')%>:</label>
    <%= f.text_field :name, :size =>25  %>
  </div>
  
  <div>
	<label for="Description"><%= t('description') %>:</label>
	<%=f.text_area :description  %>
  </div>
  <div>
    <label for="Location"><%= t('event.location') %>:</label>
    <%= f.text_field :location, :size =>25  %>
  </div>
  <div>
    <label for="Organizer"><%= t('organizer') %>:</label>
    <select id="organizers_name" multiple="multiple" name="organizers[name][]">
      <%=options_for_select_with_class_selected(@space.users.map{|u| u.login}, @event.organizers.map{|u| u.login})%>
    </select>
  </div>
   <div class="margin-up">
   <span class="bold">1. <%= t('event.select_date')%></span>
  </div>
 
  <div id="expanded_date" class="javascript">
	<div class="margin-up">
	  <span><%= t('timezone.one') %>: <%=Time.zone%></span>
	</div>
    <div class="no_javascript">
    <ul>
      <li><%= t('date.start') %></li>
	  <li><%=f.datetime_select :start_date%></li>
   	  <li><%= t('date.end') %></li>
	  <li><%=f.datetime_select :end_date%></li>
	</ul>
    </div>
  </div>
  
  <div class="margin-up">
  	  <span class="bold">2. <%= t('mark_checkbox')%> </span>
  </div>
  
  
  <div id="expanded_online">
	 
  <div class="checkbox_event">
		<%=f.check_box :isabel_event,:class=>"icon"  %>
		<label for="isabel_event" class="label_izquierda" ><%= t('event.Isabel') %></label>
		<%=f.check_box :marte_event ,:class=>"icon" %>
		<label for="marte_event" class="label_izquierda" ><%= t('event.online') %></label>
	</div>
  </div>
	
  <div class="margin-up">
    <span class ="without_javascript bold">3. <%= t('user.invite') %>:</span>
    <span class ="javascript bold" style="display:none">3. <%= link_to(t('user.invite'),"#expanded_invite",:id=>"toggle_invite") %>:</span></strong>
  </div> 
	
       <div id="already_invited_users">
	 <%unless @invited_candidates.empty? && @invited_emails.empty?%>  
	 <%= t('user.invited') %>:<br/>
	   <% for event_inv in @invited_candidates %>
	 	<%=event_inv.candidate.name%>
	   <%end%>
	   <% for event_inv in @invited_emails %>
	 	<%=event_inv.email%>
	   <%end%>
	 <%end%>
      </div>
   <div id="selected_users">
    <label for="selected_users" style="display: none;"><%= t('event.to') %>:</label>
  </div>
  
      
  <div id="user_filter" class="margin-up" style="display: none;">
    <label for="User filter"><%= t('user.filter') %></label><br/>
    <%= text_field_tag :user_selector,'', :size => 25 %>
  </div>
  <div id="unselected_users"> 
  <% for user in @users_in_space_not_invited -%>
      <div class=user_checkbox>
        <%= check_box_tag "event[ids][]", user.id, false %><%= label("checkbox",sanitize(user.full_name))%><br />
      </div>
  <%end%>
  </div>
	
	
	<%if current_user.superuser? or @space.role_for?(current_user, :name => 'Admin')%>
	  
	   
	  <div class="margin-up">
	    <label for="e-mails" class="label_izquierda" ><%= t('user.invite_email') %> <%= t('e-mail.commas') %>:</label>
			<%= f.text_area :mails%>
		</div>	
	<%else%>
	 <div>
	       	
	 </div>	
	<%end%>
        <div class="margin-up">
	  <label for="message" class="label_izquierda"><%= t('user.invitation.label') %>:</label>
	  <textarea id="invite_msg" name="event[invite_msg]"><%= t('user.invitation.message') %> &#13<%= t('user.invitation.sign',:username=>current_user.login) %></textarea>
	  <p>* <%= t('user.invitation.legend') %></p>
	</div>	
	
	<div>
  </div>
	<div class="margin-up">
	  <button type="submit"><%=t("button.update")%></button>
	</div>  	

<% end %>
</div>
