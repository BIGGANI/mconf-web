<% content_for :javascript do%>
  <%= render :partial => 'toggle_view'%>
  template = "<%= escape_javascript(t('invitation.message',:space=>@space.name,:url=>"'url'",:username=>current_user.login,:useremail=>current_user.email,:userorg=>current_user.organization)) %>";
  $("#event_name").blur(function(){
    replace_invitation();
  });
  
  function replace_invitation(){
    if(edited_msg==true)
      return;
	
    invitation_text = template;
    if($("#event_name").val()!=""){
     invitation_text = invitation_text.replace('event_name',$("#event_name").val());
    }
   if($("#start_datepicker").val()!=""){
     invitation_text = invitation_text.replace('event_date',$("#start_datepicker").val() + " at " + $("#start_timepicker").val());
   }  
   $("#invite_msg").val(invitation_text);
  };
  
  
  //we detect the user editing the invitation message
  old_text = "";
  edited_msg = false;
  $("#invite_msg").focus(function(){
    old_text = $("#invite_msg").val();
  });
  
  $("#invite_msg").blur(function(){
    if( $("#invite_msg").val() != old_text)
	{
	  edited_msg = true;
	}
  });
  
  //fist we detect if the option is checked and update the location field
  if($("#event_marte_event").is(":checked"))
  {
    $("#event_location").val("<%= t('event.online') %>");
    $("#event_location").attr('disabled', true);
  }
    
  
  $("#event_marte_event").click(function(){
    if($("#event_marte_event").is(":checked"))
    {
      $("#event_location").val("<%= t('event.online') %>");
      $("#event_location").attr('disabled', true);
    }
    else
    {
      $("#event_location").val("");
      $("#event_location").attr('disabled', false);
    }
    
  });
  
  $('#cancel_event').click(function(){
    $('#extra-info').hide();
	$('#change-event').hide();
	$('#event_creation').show("slow");
  });
  
  $('#presential_event').click(function(){
    $('#event_creation').hide();
	$('#change-event').show("slow");
	$('#event_type').val('presential');
  });
  
  $('#meeting_event').click(function(){
    $('#event_creation').hide();
	$('#change-event').show("slow");
	$('#extra-info').show();
	$('#event_type').val('meeting');
  });
  
  $('#conference_event').click(function(){
    $('#event_creation').hide();
	$('#change-event').show("slow");
	$('#extra-info').show();
	$('#event_type').val('conference');
  });
  
<%end%>

<% content_for :headers do  -%>
  <%= javascript_include_tag 'user_filter'%>
<% end -%>

<div id="event_creation">
	<h3><%= t('event.create.title') %></h3>
	<span><%=t('event.create.info.basic')%>:</span>
	<ul>
		<li><strong><%=t('event.create.info.presential.name')%></strong></li>
		<li><strong><span><%=t('event.create.info.meeting.name')%>:</span></strong><%=t('event.create.info.meeting.message')%></li>
		<li><strong><span><%=t('event.create.info.conference.name')%>:</span></strong><%=t('event.create.info.conference.message')%></li>
	</ul>
  	<div class="button_wrapper">
  	  <button id="presential_event" class="big_button orange_button margin-up"><%=t('event.new.presential')%></button>
	  <button id="meeting_event" class="big_button orange_button margin-up"><%=t('event.new.meeting')%></button>
  	  <button id="conference_event" class="big_button orange_button margin-up"><%=t('event.new.conference')%></button>
    </div>
</div>

<div id="change-event" style="display:none">
	
<h3><div id="help" title=<%=t('event.help.create')%>></div><%= t('event.create.title') %></h3>

<% form_for(:event, :url => space_events_path(@space), :html => { :multiple => "multiple" }) do |f| -%>
 <div>
    <strong><span>1. <%= t('event.basic_info')%></span></strong><br/>
    <label for="Name"><%= t('name.one')%>:</label>
    <%= f.text_field :name, :size =>25  %>
  </div>
  <div>
	<label for="Description"><%= t('description') %>:</label>
	<%=f.text_area :description%>
  </div>
  
  <div>
    <label for="Organizer"><%= t('organizer') %>:</label>
    <%=select(:organizers, :name, @space.users.map{|u| u.login}, {}, {:multiple=>"multiple"})%>
  </div>
  <div>
    <label for="Location"><%= t('event.location') %>:</label>
    <%= f.text_field :location, :size =>25  %>
  </div>
  <div class="margin-up">
  <strong><span>2. <%= t('event.select_date')%></span></strong>	
  </div>
  <div id="expanded_date">
	<div class="no_javascript">
	  <ul>
		<li><%= t('date.start') %></li>
		<li><%=f.datetime_select :start_date%></li>
		<li><%= t('date.end') %></li>
		<li><%=f.datetime_select :end_date%></li>
	  </ul>
	</div>
  </div>
  <%= f.hidden_field :type, :value => "presential" %>
  <div id="extra-info"  style="display:none">
    <div class="margin-up">
      <strong><span>3. <%= t('event.enable.participation')%></span></strong>	
    </div>
    <div class="checkbox_event">
	  <%=f.check_box :enable_isabel,:class=>"icon", :checked => true  %>
	  <label for="enable_isabel" class="label_izquierda" ><%= t('event.enable.isabel') %></label>
	</div>
	<div class="checkbox_event">
	  <%=f.check_box :enable_web,:class=>"icon", :checked => true  %>
	  <label for="enable_isabel" class="label_izquierda" ><%= t('event.enable.web') %></label>
	</div>
	<div class="checkbox_event">
	  <%=f.check_box :enable_sip,:class=>"icon", :checked => true  %>
	  <label for="enable_isabel" class="label_izquierda" ><%= t('event.enable.sip') %></label>
	</div>
  </div>
	<div class="margin-up">
	 <button type="submit" class="basic_button blue_button"><%=t("button.create")%></button>
	 <%= link_to "<span>" + t('cancel') + "</span>", "",:class => "basic_button blue_button", :id=>"cancel_event"%>
	</div>
<% end %>
</div>


