<% menu :events %>
<% atom_link_header(space, Event.new) %>

<%content_for :headers do%>
  <%= javascript_include_tag 'jquery.timeentry','jquery.mousewheel' %>
<%end%>

<%if @space.authorizes?([:create, :content],:to => current_user)%>
	<% content_for :sidebar do  %>
  	<%if params[:edit]%>
    	<%@event = Event.find(params[:edit])%>
    	<%=render :partial => 'edit_event'%>
  	<%else%>
    	<%= render :partial=> 'new_event'%>
  	<%end%>
	<%end%>
<%end%>

<% content_for :javascript do %>

$(".no_javascript").after(
  "<div class='javascript'><input type='date' id='start_datepicker' name='event[start_date]' class= 'datepicker small-font' value= <%= @event.present? ? @event.start_date.month.to_s + "/" + @event.start_date.day.to_s + "/" + @event.start_date.year.to_s : "" %>> <%=escape_javascript(link_to "Start date", "javascript:start_datepicker_setdate()")%><br/> "  
	+ "<input type='time' id='start_timepicker' name='event[start_hour]' class='timepicker small-font' value= <%= @event.present? ? @event.start_date.to_time.hour.to_s + ":" + @event.start_date.to_time.min.to_s + ":" + @event.start_date.to_time.sec.to_s : "" %>> <%=escape_javascript(link_to "Start hour", "javascript:start_timepicker_setTime()")%><br/>"   
	+ "<input type='date' id='end_datepicker' name='event[end_date]' class='datepicker small-font'value= <%= @event.present? ? @event.end_date.month.to_s + "/" + @event.end_date.day.to_s + "/" + @event.end_date.year.to_s : "" %>> <%=escape_javascript(link_to "End date", "javascript:end_datepicker_setdate()")%><br/>"
	+ "<input type='time' id='end_timepicker' name='event[end_hour]' class='timepicker small-font' value= <%= @event.present? ? @event.end_date.to_time.hour.to_s + ":" + @event.end_date.to_time.min.to_s + ":" + @event.end_date.to_time.sec.to_s : "" %>> <%=escape_javascript(link_to "End hour", "javascript:end_timepicker_setTime()", :class => "timepicker_launcher")%></div>"

);
$(".no_javascript").remove();

/*
 * Timepicker and datepicker configuration
 */

$(".datepicker").datepicker();
$('.timepicker').timeEntry({show24Hours: true, showSeconds: true, spinnerImage: '../../images/ui/up-down.png', 
    spinnerSize: [15, 16, 0], spinnerBigSize: [30, 32, 0], spinnerIncDecOnly: true, show24Hours: true });

start_timepicker_setTime = function(){
  $("#start_timepicker").timeEntry('setTime');
};


/*
 * Timepicker and datepicker launch functions
 */

end_timepicker_setTime = function(){
  $("#end_timepicker").timeEntry('setTime');
};

start_datepicker_setdate = function(){
  $("#start_datepicker").datepicker('show');
};

end_datepicker_setdate = function(){
  $("#end_datepicker").datepicker('show');
};

/*
 * Jquery timepicker calls to set timepicker clicking time
 */

$("#start_timepicker").click(function(){
  if($(this).val()==""){
    start_timepicker_setTime()
	}
});

$("#end_timepicker").click(function(){
  if($(this).val()==""){
	  end_timepicker_setTime()
	}
});

var actual_page = <%=params[:page] ? params[:page] : 1%>
jQuery.fn.calculate_page = function() {
  var b = $(this[0]).html()  
  if (b == "Next »"){
	  b=actual_page + 1;
	}
	if (b == "« Previous"){
	  b =actual_page - 1;
	}
	return b;
};

<% end %>

<% content_for :search do  %>
  <% form_tag(search_events_path(@space)) do %>
      <%= text_field_tag :query, params[:query], :size=>'18' %>
	   <%= image_submit_tag "buttons/search.png"%>
	   <div id="advanced">
	     <%= link_to 'Advanced', advanced_search_events_path(@space) %>
     </div>
   <% end %>
<%end%>

 
   <div class="single_event">
    <ul class="group_links">
      <li><%=link_to image_tag("./icons/pencil.png", :alt => "edit") , space_events_path(@space,:edit => @event_to_show), :title => "edit" if @event_to_show.authorizes?(:update, :to => current_user) %></li>
	  <li><%=link_to image_tag("./icons/cross.png", :alt => "delete") , space_event_path(@space, @event_to_show),{:method => :delete, :title => "destroy"} if @event_to_show.authorizes?(:delete, :to => current_user) %></li>
    </ul>
    <p><%=image_tag("icons/date.png",:class=>"icon")%> <strong><%=sanitize(@event_to_show.title)%></strong><span class="updated"> Updated <%=sanitize(time_ago_in_words(@event_to_show.updated_at))%> ago</span></p>
    <ul>
		<li class="date"><%=sanitize(@event_to_show.start_date.to_formatted_s(:short))%> - <%=sanitize(@event_to_show.end_date.to_formatted_s(:short))%></li>
		<li class="author"> Author: <%=sanitize(@event_to_show.author.name)%></li>
		<%if @event_to_show.isabel_event%>
			<li class=""> This event will be held with <%= link_to 'Isabel', 'http://isabel.dit.upm.es'%></li>
		<%elsif @event_to_show.marte_event%>
			<li class=""> Follow this event  <%= link_to 'online', space_event_path(@space, @event_to_show)%></li>
		<%end%>
		
		<li> Description: <%=sanitize(@event_to_show.description)%></li>
    </ul>
 </div>



