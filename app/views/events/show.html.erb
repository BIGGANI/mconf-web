<% menu :events %>
<% atom_link_header(space, Event.new) %>

<%content_for :headers do%>
  <%= javascript_include_tag 'jquery.timeentry','jquery.mousewheel','jquery.filestyle', 'user_filter','jquery.ba-url' %>
<%end%>

<% content_for :javascript do %>	
  <%= render :partial => 'date_and_timepicker.js.erb' %>	
  <%= render :partial => 'agenda_entries/timepicker.js.erb' %>

	style_file_input();
	
	$("#query").click(function(){
	  if(this.value == "Search events..."){
		  this.value="";
		}
	});
	
	$("#event_description_title").click(function(){
	  $("#event_description_content").toggle("slow");
	});
	
	$("#agenda_title").click(function(){
	  $("#agenda_content").toggle("slow");
	});
	
	$("#repository_title").click(function(){
	  $("#repository_content").toggle("slow");
	});
	
	$("#streaming_title").click(function(){
	  $("#streaming_content").toggle("slow");
	});
	
	$("#change_logo").click(function(){
	  $('#assistance_info').hide();
	  $('#new_reply').hide();
	  $('#questions').hide();
	  $("#update_logo").show();
	  $("#update_logo").effect("highlight", {color:"#F5DF51"}, 3000);
	});
	
	$(".event_image").click(function(){
	  $("#change_logo").click();
	});

	
   <%if event.authorize?(:update, :to => current_user)%> 
     $('#event_description_content').editable('<%=space_event_path(@space, @event)%>',{
        method : 'PUT',
	tooltip   : '<%= t('dblclick')%>',
        cancel    : '<%= t('cancel')%>',
        submit    : '<%= t('ok')%>',
        indicator : '<img src="ui/icons/accept.png" />',
        placeholder: '<%=t("event.description.none")%> <%=link_to_function t('event.description.add'), "edit_description()", :id => "add_description_link"%>',
        type      : 'textarea',
        name : 'event[description]',
	width : 490,
	height: 250,
	event     : "dblclick",
	data: function(value, settings) {
          /* Convert <br> to newline. */
          var retval = value.replace(/<br[\s\/]?>/gi, '');
          retval = retval.replace(/<p[\s\/]?>/gi, '');
          retval = retval.replace(/<\/p[\s\/]?>/gi, '');
          return retval;
        },
        submitdata : {authenticity_token: "<%=form_authenticity_token()%>"},
     });
	 
     $('#event_description_content form input').livequery("blur",function(){
       $('#edit_description_icon').show();
     });
   
     edit_description = function(){
       $('#event_description_content').dblclick();
     };

   <%end%>
   
<% end %>


<% content_for :sidebar do  %>
    <div id="full_sidebar">
      <%if @space.authorize?([:create, :content],:to => current_user)%>
  	 <%if params[:edit_event]%>
     	   <%=render :partial => 'edit_event', :locals => {:event => @event_to_edit}%>
	 <%elsif params[:edit_comment]%>
	   <%=render :partial => 'edit_comment', :locals => {:post => Post.find(params[:edit_comment])}%>
	 <%elsif params[:new_invitations]%>
	   <%=render :partial => 'new_invitations', :locals => {:checked_users => Array.new} %>
	 <%else%>
	   <%= render :partial => 'participants' %>
	   <%= render :partial => 'new_comment'%>
  	<%end%>
     <%end%>
     <%if event.authorize?(:update, :to => current_user) %>
       <div id="update_logo" style="display:none">
         <h3><%=@event.logo ? t('event.logo.select') : t('event.logo.new') %></h3>
         <% form_for :event_logo, :url => space_event_logo_path(@space, @event), :html => { :multipart => true, :method => :put} do |f| %>
           <div><%= f.file_field :media, :id => 'logo_media' %></div>   
           <div class="margin-up"><button type="submit"><%=t("button.update")%></button></div>
         <%end%>
       </div>
     <%end%>
   </div>
<%end%>


<% content_for :search do  %>
  <% form_tag(search_events_path(@space)) do %>
     <%= text_field_tag  'query',(params[:query] ? params[:query] : t('event.search') ) %>
	   <button type="submit"><%=t("button.go")%></button>
	   <div id="advanced">
	     <%= link_to t('advanced'), advanced_search_events_path(@space) %>
     </div>
   <% end %>
<%end%>

  <div id="event_card_show">
  <%= render :partial => "event_card_show" %>
  </div>

  <div id="for_lightbox" style="display:none"></div>

  <%=render :partial => "external_streaming"%>

  <%if @event.agenda.present?%>
    <div id="agenda_full" class="margin-up">      
      <div id="agenda_title"><h3><%=t('agenda.title')%> <span class="main_text"><%= t('timezone.one') %>: <%=Time.zone%></span></h3></div>
      <div id="agenda_content">
        <%= render :partial => "agendas/edit" %>
      </div>
    </div>
  <%end%>
   
  <div id="event_repo" class="margin-up">
    <div id="repository_title"><h3><%=t('event.repository')%></h3></div>
    <div id="repository_content">
    	<%= render :partial => 'attachments/tag_filter' %>
      <%= render :partial => "attachments/doc_table" %>
    </div>
  </div>
  
 
<%unless @comments.empty?%> 
	<div>
		<h3 class="selector_title"><%= t('comment.other') %></h3>
		
			<% for post in @comments %>
				<%= render :partial => 'event_comment' , :locals => {:post => post}%>
		  <%end%>
				
				
			<%if @space.authorize?([:create, :content],:to => current_user)%>
					<div class="add-new-comment">
						<%=link_to t('comment.add_new'), space_event_path(@space, @event), { :title => t('comment.add_new') } %>
					</div>
			<%end%>
	
			<div id="paginate">
			      <%= will_paginate @comments%>
			</div>
	</div>
<%end%>
