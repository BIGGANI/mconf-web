-# locals: user

- if can?(:show, user)
  .user-wrapper.user-detailed.thread.thread-user{:class => "#{cycle("thread-even" , "thread-odd")}"}
    .logo-in-thread
      = link_logo_image(user, :size => '48', :url => user_path(user), :title => user.name, :class => "logo logo-user-big")
    .thread-title
      = link_to sanitize(user.full_name), user_path(user), :class => 'user-name'
    .user-text
      - if can?(:show, user.profile)
        %span.user-mail= mail_to(user.email, user.email)

      - if !user.organization.blank? || !user.location.blank?
        %span.user-info-prefix= t(".from")

      - unless user.organization.blank?
        %span.user-organization= sanitize(user.organization)
        - unless user.location.blank?
          %span.user-divider= "--"

      - unless user.location.blank?
        %span.user-location= sanitize(user.location)

    - perm = Permission.where(user: user, subject: @space).first
    - if can?(:destroy, perm)
      - if user == current_user
        -# Use link to leave space if the user show is the current user
        -# This already handles cases where the user loses the ability to 'show'
        -# the space to which he belonged and must be redirected to the root.
        - if can?(:leave, @space)
          - link = leave_space_path(@space)
          - params = { method: :post, class: 'btn btn-mini btn-danger', data: { confirm: t('space.confirm') } }
          %span.user-remove= link_to t('space.leave.leave_this_space'), link, options_for_tooltip(t("tooltip.leave_space"), params)
      - else
        -# Otherwise, use a 'delete' with the Permission
        - params = { method: :delete, class: 'btn btn-mini btn-danger', data: { confirm: t('space.remove_user.confirm') } }
        %span.user-remove= link_to t('space.remove_user.remove'), permission_path(perm), params
