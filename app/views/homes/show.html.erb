
<% content_for :headers do  -%>
  <%= javascript_include_tag 'jquery.filestyle', 'fckeditor/fckeditor' %>
<% end -%>

<% content_for :javascript do %>

/*
 *  Expand and collapse thread
 */
  extend_thread = function(id){
    $("#parent_" + id + " .extended_thread").show();
    $("#parent_" + id + " .extend_thread").hide();
    $("#parent_" + id + " .collapse_thread").show();
    $("#message-body-" + id).hide();
  }
	
  collapse_thread = function(id){
    $("#parent_" + id + " .extended_thread").hide();
    $("#parent_" + id + " .extend_thread").show();
    $("#parent_" + id + " .collapse_thread").hide();
    $("#message-body-" + id).show();
  }  
  
  
  $("input#checkposts").click(function(){
    $(".post_cloud").slideToggle("slow");
  });
  
  $("input#events").click(function(){
    $(".event_cloud").slideToggle("slow");
  });
  
  $("input#news").click(function(){
    $(".news_cloud").slideToggle("slow");
  });
  
  
<% end %>


<% content_for :sidebar do  %>
  <div class="next-events">
     <div class="next-events-title">
       <h3><%=image_tag("icons/date.png",:class=>"icon") + " " + t('calendar.my')%> <span class="small-font">(GMT <%= Time.zone.formatted_offset %> )</span></h3>
     </div>
	
	  <div class="next-events-section">
	    <%if @today_events.empty?%>
	      <span class="bold"><%=t('today')%></span> <%=t('event.no_events')%> <br/>
	    <%else%>
	      <span class="bold"><%=t('today')%></span>
	      <ul>
		  <% for event in @today_events -%>
                <li class="event">
                  <%event_link="<span class='red'>" + sanitize(event.title) + "</span> <br/> <span class='small-font'>" + event.start_date.to_formatted_s(:short) + " - " + event.end_date.to_formatted_s(:short) + "</span>"%>
                  <%=link_to event_link, space_event_path(event.space,event)%>
                  <%=link_to "", space_event_path(event.space,event),:class=>"box-link"%>
                </li>
          <%end%>
		  </ul>
	    <%end%>
	  </div>
	  <div class="next-events-section">
	    <%if @tomorrow_events.empty?%>
	      <span class="bold"><%=t('tomorrow')%></span> <%=t('event.no_events')%> <br/>
	    <%else%>
	      <span class="bold"><%=t('tomorrow')%></span>
	      <ul>
		    <% for event in @tomorrow_events -%>
              <li class="event">
                <%event_link="<span class='red'>" + sanitize(event.title) + "</span> <br/><span class='small-font'>" + event.start_date.to_formatted_s(:short) + " - " + event.end_date.to_formatted_s(:short) + "</span>"%>
                <%=link_to event_link, space_event_path(event.space,event)%>
                <%=link_to "", space_event_path(event.space,event),:class=>"box-link"%>
              </li>
            <% end -%>
	      </ul>
		<%end%>
	  </div>
	  <div class="next-events-section">
	    <%if @week_events.empty?%>
	      <span class="bold blue"><%=t('week.next')%></span> <%=t('event.no_events')%> <br/>
	    <%else%>
	      <span class="bold blue"><%=t('week.next')%></span>
	      <ul>
		    <% for event in @week_events -%>
              <li class="event">
                <%event_link="<span class='red'>" + sanitize(event.title) + "</span> <br/> <span class='small-font'>" + event.start_date.to_formatted_s(:short) + " - " + event.end_date.to_formatted_s(:short) + "</span>"%>
                <%=link_to event_link, space_event_path(event.space,event)%>
                <%=link_to "", space_event_path(event.space,event),:class=>"box-link"%>
              </li>
            <% end -%>
	      </ul>
		<%end%>
	  </div>
	  <div class="next-events-section">
	    <%if @upcoming_events.empty?%>
	      <span class="bold blue"><%=t('event.upcoming.other')%></span> <%=t('event.no_events') %><br/>
	    <%else%>
	      <span class="bold blue"><%=t('event.upcoming.other')%></span>
	      <ul>
		    <% for event in @upcoming_events -%>
              <li class="event">
                <%event_link="<span class='red'>" + sanitize(event.title) + "</span><br/> <span class='small-font'>" + event.start_date.to_formatted_s(:short) + " - " + event.end_date.to_formatted_s(:short) + "</span>"%>
                <%=link_to event_link, space_event_path(event.space,event)%>
                <%=link_to "", space_event_path(event.space,event),:class=>"box-link"%>
              </li>
            <% end -%>
	      </ul>
		<%end%>
	  </div> 
	
  </div>
  
  <div id="home-inbox-full" class="margin-up">
    
	<div id="home-inbox-title">
    	<h3><%=image_tag("icons/email.png",:class=>"icon")%> <%= link_to t('inbox.my', :checked => PrivateMessage.inbox(current_user).select{|msg| !msg.checked}.size), user_messages_path(current_user), menu_options(:inbox, :id => "user_inbox_link")%></h3>
	</div>
	<%if @private_messages.empty?%>
	  <div class="next-events-section">
	    <span> <%=t("message.private.none")%></span>
	  </div> 	
	<%else%>
	    <% for private_message in @private_messages %>
	      <%@sender=User.find_with_disabled(private_message.sender_id)%>
		  <div class="next-events-section">
		      <div class="user-logo"><%=link_logo(@sender,:size=>32, :url => user_profile_path(@sender), :title=>@sender.login)%></div>  
		      <div class="home-inbox-message">
		        <span class="home-inbox-topic"> <%= link_to first_words(sanitize(private_message.title),25), user_messages_path(current_user, :message=>private_message.id)%></span><br/>
		        <%= sanitize(first_words(private_message.body,35))%>
		      </div>
		  </div>  
	    <% end %>
	<% end %>
  </div>
<% end %>  


<div id="recent-activity">
	<div id="home_menu">  
	  <div id="show">
	    <%=t('show')%>:
	    <%= check_box_tag "checkposts","checkposts",true%><%= label_tag "Posts"%>  <%= check_box_tag "events","events",true%><%= label_tag "Events" %><%= check_box_tag "news","news",true%><%= label_tag "News"%>
	  </div>
	  <div id="help" title= "<%= t('information.information2')%>"></div>
	  	<h3><%=t('home.activity')%></h3>
	</div>

  <%unless @today.empty?%>
    <div id="line">
		<span class="bold">Today</span>
    </div>
  <%end%>
  <%today_last_item = @today.last%>
  <% for item in @today do %>

	<%if item.class == Post %>
	  <%@space=item.space%>
	  
	  <%= render :partial => "posts/post_in_home" , :locals => {:thread => item, :extended => false, :last => item==today_last_item } %>
	<%elsif item.class == Event %>
	  <%@space=item.space%>
	  <%= render :partial => 'events/event_in_home', :locals => {:event=>item, :last => item==today_last_item} %>
	<%elsif item.class == News %>
	  <%@space=item.space%>
	  <%@news_to_show = item%>
	  <%@news_position = 1 %>
	  <%@news=[]%>
	  <%= render :partial => 'spaces/news_in_home', :locals =>{:last => item==today_last_item}%>
	<%else%>
	  I don't know what is a "<%item.class%>"
	<%end%>
  <% end %>
  <%unless @yesterday.empty?%>
    <div id="line">
		<span class="bold">Yesterday</span>
    </div>
  <%end%>
  <%yesterday_last_item = @yesterday.last%>
  
  <% for item in @yesterday do %>	
	<%if item.class == Post %>
	  <%@space=item.space%>
	  <%= render :partial => "posts/post_in_home" , :locals => {:thread => item, :extended => false, :last => item==yesterday_last_item} %>
	<%elsif item.class == Event %>
	  <%@space=item.space%>
	  <%= render :partial => 'events/event_in_home', :locals => {:event=>item, :last => item==yesterday_last_item} %>
	<%elsif item.class == News %>
	  <%@space=item.space%>
	  <%@news_to_show = item%>
	  <%@news_position = 1 %>
	  <%@news=[]%>
	  <%= render :partial => 'spaces/news_in_home', :locals =>{:last => item==yesterday_last_item}%>
	<%else%>
	  I don't know what is a "<%item.class%>"
	<%end%>
  <% end %>
  <%unless @last_week.empty?%>
    <div id="line">
		<span class="bold">Last Week</span>
    </div>
  <%end%>
  <%week_last_item = @last_week.last%>
  <% for item in @last_week do %>	
	<%if item.class == Post %>
	  <%@space=item.space%>
	  <%= render :partial => "posts/post_in_home" , :locals => {:thread => item, :extended => false, :last => item==week_last_item} %>
	<%elsif item.class == Event %>
	  <%@space=item.space%>
	  <%= render :partial => 'events/event_in_home', :locals => {:event=>item, :last => item==week_last_item} %>
	<%elsif item.class == News %>
	  <%@space=item.space%>
	  <%@news_to_show = item%>
	  <%@news_position = 1 %>
	  <%@news=[]%>
	  <%= render :partial => 'spaces/news_in_home', :locals =>{:last => item==week_last_item}%>
	<%else%>
	  I don't know what is a "<%item.class%>"
	<%end%>
  <% end %>
  <%unless @older.empty?%>
    <div id="line">
		<span class="bold">Older items</span>
    </div>
  <%end%>
  <%older_last_item = @older.last%>
  <% for item in @older do %>	
	<%if item.class == Post %>
	  <%@space=item.space%>
	  <%= render :partial => "posts/post_in_home" , :locals => {:thread => item, :extended => false, :last => item==older_last_item} %>
	<%elsif item.class == Event %>
	  <%@space=item.space%>
	  <%= render :partial => 'events/event_in_home', :locals => {:event=>item, :last => item==older_last_item} %>
	<%elsif item.class == News %>
	  <%@space=item.space%>
	  <%@news_to_show = item%>
	  <%@news_position = 1 %>
	  <%@news=[]%>
	  <%= render :partial => 'spaces/news_in_home', :locals =>{:last => item==older_last_item}%>
	<%else%>
	  I don't know what is a "<%item.class%>"
	<%end%>
  <% end %>
  
  <%@space=nil #to avoid the selector highlight any space%>
  <%= will_paginate @all_in_all %><br/>
</div>
