<% spaces_menu_at :posts %>
<%= content_for :menu do %>
  <%= render :partial => 'spaces/menu' %>
<% end %>
<% atom_link_header(space, Post.new, :title => h(t('post.other_in_space', :space => space.name))) %>

<% # TODO: remove javascript to independent js files %>
<%= content_for :headers do %>
<script type="text/javascript" charset="utf-8">
$(document).ready(function() {

$("a.edit_post_link").click(function(){
  var route = "<%= space_posts_path(@space) %>" + "/" + $(this).attr("name") + "?edit=true";
  $.get(route,
         {authenticity_token: "<%=form_authenticity_token()%>"},
         function(data){
           $("#sidebar").children("div:last").replaceWith(data);

           $(".edit_thread_options").click(function(){
             $(".edit_thread_options").removeClass("selected");
             $(this).addClass("selected");});

             /*Edit reply*/
             $(".edit_reply_options").click(function(){
               $(".edit_reply_options").removeClass("selected");
               $(this).addClass("selected");});

               /*Scroll to the edit form*/
               var destination = $('#add').offset().top;
               $("html:not(:animated),body:not(:animated)").animate({ scrollTop: destination}, 1100, function() {
                 window.location.hash = '#add'

               });

               setTimeout(function() {
                 $("#edit_reply").effect("highlight", {color:"#F5DF51"}, 3000);
                 $("#edit_thread").effect("highlight", {color:"#F5DF51"}, 3000);
               }, 1000);
         });

         return false;
});


  big_edit_thread_modal = function() {
    return {
      'onComplete' : function(){
        $(".big_post_text").val($(".small_post_text").val());
        $(".big_post_title").val($(".small_post_title").val());
        $("textarea#post_text").remove();//IE Compatibility
        big_textarea();
        $("#fancy_outer").width($("#new_thread_big").width() + 50);
        $("#fancy_outer").height($("#new_thread_big").height() + 80);
        $(window).resize();
      },
      'onClosed' : function(){
        var oEditor = FCKeditorAPI.GetInstance('post[text]') ;
        var data = oEditor.GetHTML();
        $("div#edit_post_content").append("<%= escape_javascript(small_post_text_area) %>"); //IE Compatibility
        $(".small_post_text").val(data);
        $(".small_post_title").val($(".big_post_title").val());
      }
    };
  };


</script>
<% end %>

<%= content_for :sidebar do  %>

  <%if can?(:create_post, @space)%>
    <%= content_for :new_post do %>
      <%= render :partial => "new_post" %>
    <% end %>
  <% end %>

  <%if can?(:create_post, @space)%>
    <% if params[:edit] %>
      <%= render :partial => "edit_post", :locals => { :post => Post.find(params[:edit]) } %>
    <%else%>
      <%= render :partial => "new_post", :locals => {:id => "thread-form" }%>
    <%end%>
  <% end %>
<% end %>

<%= render :partial => "collapsed_threads", :locals => {:threads => @posts} %>
<%= page_navigation_links @posts %>
