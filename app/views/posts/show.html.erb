<% menu :posts %>

<% content_for :headers do  -%>
  <%= javascript_include_tag 'jquery.filestyle'%>
<% end -%>

<% content_for :javascript do %>

/*
 *  Reply panel
 */

$("#reply-form").postsForm('<%= space_post_path(@space,@post, :last_page => true) %>');

style_file_input();

$(".new_reply_options").click(function(){
    $(".new_reply_options").removeClass("selected");
    $(this).addClass("selected");
});

$("#new_comment_link").livequery('click',function () { 
  $("#new_photo_form").hide();
  $("#new_doc_form").hide();
  return false;
});

$("#new_photo_link").livequery('click',function () {
  $("#new_photo_form").show(); 
  $("#new_doc_form").hide();
  return false;
});

$("#new_doc_link").livequery('click',function () {
  $("#new_photo_form").hide();
  $("#new_doc_form").show();
  return false;
});

$("a.edit_post_link").click(function(){
  var route = "<%= space_posts_path(@space) %>" + "/" + $(this).attr("name") + "?edit=true";
  $.get(route,
      {authenticity_token: "<%=form_authenticity_token()%>"},
      function(data){
        $("#sidebar").children("div:last").replaceWith(data);
				
				 /*Edit thread*/
         $(".edit_thread_options").click(function(){
         $(".edit_thread_options").removeClass("selected");
         $(this).addClass("selected");});
         
         /*Edit reply*/
         $(".edit_reply_options").click(function(){
         $(".edit_reply_options").removeClass("selected");
         $(this).addClass("selected");});
				 
				 style_file_input();
      }
    );
  return false;
});

	$("#space_search").click(function(){
	  if(this.value == "Search Posts..."){
		  this.value="";
		}
	});

<% end %>

<% content_for :search do  %>
  <% form_tag(search_posts_path(@space), :method => 'get') do %>
      <%= text_field_tag 'space_search',(params[:query] ? params[:query] :  "Search Posts...")%>
	  <%= image_submit_tag "buttons/search.png"%>
  <% end %>
<%end%>
<%if @space.authorizes?([:create, :content],:to => current_user)%>
	<% content_for :sidebar do  %>
	  <%if params[:edit]%>
		  <% post = Post.find(params[:edit]) %>
      <% if post.parent_id %>
          <%= render :partial => "edit_reply", :locals => { :post => post } %>
      <% else %>
          <%= render :partial => "edit_thread", :locals => { :post => post } %>
      <% end %>
		<%else%>
  	  <% params[:reply_to] = @post.id %>
  	  <%= render :partial => "new_reply", :locals => { :post => @post } %>
		<%end%>
	<% end %>
<% end %>

<%= render :partial => 'post_with_children' %>

<%= will_paginate @posts %>
