<% spaces_menu_at :posts %>

<% # TODO: remove javascript to independent js files %>
<%= content_for :headers do %>
<script type="text/javascript" charset="utf-8">
$(document).ready(function() {

$("a.edit_post_link").click(function(){
  var route = "<%= space_posts_path(@space) %>" + "/" + $(this).attr("name") + "?edit=true";
  $.get(route,
      {authenticity_token: "<%=form_authenticity_token()%>"},
      function(data){
        $("#sidebar").children("div:last").replaceWith(data);

         /*Edit thread*/
         $(".edit_thread_options").click(function(){
         $(".edit_thread_options").removeClass("selected");
         $(this).addClass("selected");});

         /*Edit reply*/
         $(".edit_reply_options").click(function(){
         $(".edit_reply_options").removeClass("selected");
         $(this).addClass("selected");});
      }
    );
  return false;
});

  big_edit_thread_modal = function() {
    return {
            'onComplete' : function(){
              $(".big_post_text").val($(".small_post_text").val());
              big_textarea();
              $("#fancy_outer").width($("#new_thread_big").width() + 50);
          $("#fancy_outer").height($("#new_thread_big").height() + 80);
              $(window).resize();
            },
            'onClosed' : function(){
              var oEditor = FCKeditorAPI.GetInstance('post[text]') ;
              var data = oEditor.GetHTML();
              $(".small_post_text").val(data);
            }
          };
  };


});
</script>
<% end %>

<%if can?(:create_post, @space)%>
  <%= content_for :sidebar do  %>
    <%if params[:edit]%>
      <%= render :partial => "edit_post", :locals => { :post => Post.find(params[:edit]) } %>
    <%else%>
      <% params[:reply_to] = @post.id %>
      <%= render :partial => "new_post", :locals => { :post => @post, :p_id=> @post.id, :id => "reply-form"} %>
    <%end%>
  <% end %>
<% end %>

<%= render :partial => 'post_with_children' %>

<%= will_paginate @posts %>
