<%content_for :headers do%>
  <%= javascript_include_tag 'jquery.fcbkcomplete','jquery.ba-url' %>
  <%= stylesheet_link_tag "fcbkcomplete", :media => "screen, projection" %>
<%end%>

<% content_for :javascript do%>

  ajax_new_version = function(){
    $("#doc_action").html("<p><%=t('form.loading')%></p>");
    $.getScript("<%=space_attachments_path(@space)%>/" + $.fragment().new_version + "/edit");
  };
  
  ajax_doc_info = function(){
    $("#doc_info").html("<h3><%=t('attachment.info')%></h3><p><%=t('attachment.loading')%></p>");
    $.getScript("<%=space_attachments_path(@space)%>/" + $.fragment().doc_info + "?version=" + $.fragment().version); 
  };

  $("#enable_javascript").hide();

  $("a.doc_show").livequery("click", function() {
	  $("#doc_action").html("");
    $.setFragment({ "doc_info" : $.queryString(this.href).doc_info, "version" : $.queryString(this.href).version, "new_version": ""});
    return false;
  });
	
	$("a.new_version").livequery("click", function() {
    $.setFragment({ "new_version" : $.queryString(this.href).new_version});
    return false;
  });
  
  $.fragmentChange(true);
	
  $(document).bind("fragmentChange", function() {
    if ($.fragment().new_version) {
      ajax_new_version();
    }else if ($.fragment().doc_info) {
		  ajax_doc_info();
		}
  });
  
  if ($.fragment().doc_info) {
    ajax_doc_info();
  };

  if ($.fragment().new_version) {
    ajax_new_version();
  };

  $("a.table_params").livequery("click",function(){
    $(this).attr("href",$.fragment(this.href,$.fragment(document.location.href)));
	});

  //Upload form
	$("#attachment__tags").fcbkcomplete({
			cache: true,
            filter_case: false,
            filter_hide: true,
            firstselected: true,
            filter_selected: true,
            maxshownitems: 4,
			newel: true
		});    

$("#add_new_doc").hide();

	
	$("input#Expandir").livequery("click",function(){
	    $("#with_post").slideToggle("slow");
	 
	});

  $("#add_document_label").livequery("click",function(){
    $("#add_new_doc").show("slow");
    $("#add_document_label").hide("slow");   
	
  });

  $("#hide").livequery("click",function(){
      $("#add_document_label").show("slow");
      $("#add_new_doc").hide("slow");     
  });
	
	
//Filter_tag
add_tag = function (){
  tags_array = tags_array();
  if($.queryString(document.location.href).tags != tags_array.join(",")){
	  hide_table();
    location.href=$.queryString(document.location.href, { "tags" : tags_array.join(",")});
  }
};

rm_tag = function (item){
  tags_array = tags_array();
  tags_array.splice(tags_array.indexOf(item._value), 1);
  if($.queryString(document.location.href).tags != tags_array.join(",")){
	  hide_table();
    location.href=$.queryString(document.location.href, { "tags" : tags_array.join(",")});
  }
};

tags_array = function(){
  array = new Array($("#attachment_tags_filter option.selected").size());
  i = 0
  $("#attachment_tags_filter option.selected").each(function(){
    array[i] = this.value;
    i++;
  });
  return array;
};

hide_table = function(){
  $("#doc_repository").html("<%=t('repository.loading')%>");
}

$("#attachment_tags_filter").fcbkcomplete({
  cache: true,
  filter_case: false,
  filter_hide: true,
  firstselected: true,
  filter_selected: true,
  maxshownitems: 4,
  newel: false,
  onremove: "rm_tag",
  onselect: "add_tag"
  
 });
 
 $(".add_tag_filter").click(function(){
   hide_table();
 });

<% end %>

<% content_for :search do  %>
   <%= render :partial => 'search' %>
<%end%>

<%content_for :sidebar do%>
  <%= render :partial => 'doc_info', :locals => {:attachment => @attachment} %>
  <%= render :partial => 'upload_form' %>
<%end%>

<div id="enable_javascript">Please, active javascript to enjoy document repository</div>
<div id ="doc_repository">
	<%= render :partial => 'doc_filter' %>
	<%= render :partial => 'doc_table' %>
</div>