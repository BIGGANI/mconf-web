<% @page_title = "Add users to the space"%>

    <SCRIPT LANGUAGE="JavaScript" TYPE="text/javascript">
    function MoveOption(objSourceElement, objTargetElement)
    {        
        //looping through source element to find selected options
        for (var i = 0; i < objSourceElement.length; i++) {
            if (objSourceElement.options[i].selected && !IsAlreadyIn(objTargetElement,objSourceElement.options[i])) {
                //need to move this option to target element
                var intTargetLen = objTargetElement.length++;
                objTargetElement.options[intTargetLen].text = objSourceElement.options[i].text;
                objTargetElement.options[intTargetLen].value = objSourceElement.options[i].value;
            }
        }
        
    }
	
	//Method to know if an element is already in a select box
	function IsAlreadyIn(objTargetElement, Element) {
		for (var i = 0; i < objTargetElement.length; i++) {
			if (objTargetElement.options[i].value == Element.value) {
				alert("The user \"" + objTargetElement.options[i].text + "\" is already in the space")
				return true;				
			}
		}
		return false;
	}
	
	//method to remove a user from the space
	function RemoveUser(objSourceElement){
		var aryTempSourceOptions = new Array();
        var x = 0;
        
        //looping through source element to find selected options
        for (var i = 0; i < objSourceElement.length; i++) {
            if (objSourceElement.options[i].selected) {
                //need to remove this option
				//I just don't save this option
            }
            else {
                //storing options that stay to recreate select element
                var objTempValues = new Object();
                objTempValues.text = objSourceElement.options[i].text;
                objTempValues.value = objSourceElement.options[i].value;
                aryTempSourceOptions[x] = objTempValues;
                x++;
            }
        }
        
        //resetting length of source
        objSourceElement.length = aryTempSourceOptions.length;
        //looping through temp array to recreate source select element
        for (var i = 0; i < aryTempSourceOptions.length; i++) {
            objSourceElement.options[i].text = aryTempSourceOptions[i].text;
            objSourceElement.options[i].value = aryTempSourceOptions[i].value;
            objSourceElement.options[i].selected = false;
        }
	}
	
	//method to select all users of the space to send them to the server
	function SendUsers(objSourceElement)
	{
		//looping through source element to find selected options
        for (var i = 0; i < objSourceElement.length; i++) {            
                //need to select this option  
				objSourceElement.options[i].selected = true;        
        }
		document.user_space_form.submit();
	}
    </SCRIPT>


<p><font face="Arial,Helvetica,sans-serif"><b>Add users to the space</b></font></p>
<p><font face="Arial,Helvetica,sans-serif">Select one or several users and add it to the space</font></p>
<% form_for @space, :url => space_path(@space.id), :html => {:method => :put, :name=>"user_space_form"} do |f| -%>
<table>
<tr>
   <td align="center"><font face="Arial,Helvetica,sans-serif" size="2"><b>All Users</b></font></td>
   <td><p>&nbsp;</p></td>
   <td align="center"><font face="Arial,Helvetica,sans-serif" size="2"><b>Space Users</b></font></td>
   <td align="center"><font face="Arial,Helvetica,sans-serif" size="2"><b>Role</b></font></td>
</tr>
<tr>
    <td>    
	<%=select("usuarios", "user_id", User.find(:all).collect {|p| [ p.login, p.id ] },{ :include_blank => false }, {:multiple => true, :size => 10, :style=>"width: 200px;" }) %>	
    </td>
 <td>
    <input type="button" name="add" value="&nbsp;&nbsp;&nbsp; Add -&gt; " style="width: 100px;" onClick="MoveOption(this.form.usuarios_user_id, this.form.users_id)"><br>
    <br>
    <input type="button" name="remove" value="Remove" style="width: 100px;" onClick="RemoveUser(this.form.users_id)"><br>
    </td>
 <td>
 	<%=select("users", "id", @space.users.collect {|p| [ p.login, p.id ] },{ :include_blank => false }, {:multiple => true, :size => 10, :style=>"width: 200px;" }) %>
    </td>
	<td>
		<%=select("role", "id", CMS::Role.find(:all).collect {|p| [ p.name, p.id ] }, {:multiple => false, :size => 10, :style=>"width: 200px;" }) %>	
	</td>
</tr>


<tr><td>

<%= render :partial=> '/users/search' %>
	</td></tr>
	<tr><td><div id= "search_results">
		
		
</div></td></tr>
 
	
<tr>
	<% end %>
	<td align="center">
	<input type="button" name="Confirm" value="Confirm" style="width: 100px;" onClick="SendUsers(this.form.users_id)">
	</td>
	<td>
    <input type="button" name="Back" value="Back" style="width: 100px;" onClick=document.location="/spaces">
	</td>
</tr>
</table>

