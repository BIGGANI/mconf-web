-# Locals:
-#   room (BigbluebuttonRoom): the target webconf room

-# Note: There's a lot happening in this view. The url of the links, texts and state of the buttons
-# depend on several factors: user logged? user can create the meeting? is meeting running?
-# so that are several possible combinations. Be careful changing it!
-# TODO: integration tests for this view would be incredibly useful

- can_create = user_signed_in? && can?(:create_meeting, room)
- running = room.is_running?

-# join button
.btn-group.webconf-join-group
  - join_text = running ? t('.join') : t('.start')
  - btn_class = running ? "btn-success" : "btn-primary"

  - if can_create
    - if running
      = link_to join_text, join_bigbluebutton_room_path(room), :class => "btn open-modal #{btn_class}"
    - else
      = link_to join_text, join_options_bigbluebutton_room_path(room), :class => "btn open-modal #{btn_class}"
      = link_to join_bigbluebutton_room_path(room), options_for_tooltip(t(".fast_start"), :class => "btn btn-primary webconf-start-link") do
        %i.icon-share-alt

  - else
    -# anonymous or non members
    - if running
      = link_to join_text, invite_bigbluebutton_room_path(room), :class => "btn #{btn_class} webconf-start-link"
    - else
      = link_to join_text, "", :class => "btn #{btn_class} disabled webconf-not-allowed-create"

-# button with options when full-feature or with "login from mobile" when restricted
.btn-group

  - if can_create
    -# people that can create a meeting have access to all options in the room
    .btn.dropdown-toggle{ :"data-toggle" => "dropdown", :href => "#" }
      = t('.options')
      .caret
    %ul.dropdown-menu.pull-right
      %li
        = link_to join_mobile_bigbluebutton_room_path(room), :class => "webconf-join-mobile-link no-icon" do
          %span= t('.join_mobile_full')
      %li= link_to t('.invite'), inviteroom_invite_path(:type => "webconference", :room => room.to_param), :class => 'open-modal'
      %li= link_to t('.preferences'), join_options_bigbluebutton_room_path(room), :class => "open-modal"

  - else
    -# anonymous or non members
    - if !user_signed_in?
      = link_to "#", :class => "btn webconf-join-mobile-link disabled login-to-enable" do
        %span= t('.join_mobile')
    - elsif !running
      = link_to "#", :class => "btn webconf-join-mobile-link disabled webconf-not-allowed-create" do
        %span= t('.join_mobile')
    - else
      = link_to join_mobile_space_room_path(@space, @webconf_room), :class => "btn webconf-join-mobile-link" do
        %span= t('.join_mobile')
